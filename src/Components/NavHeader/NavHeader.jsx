import React, { useEffect, useRef, useState } from 'react';
import { StyleSheet, Text, TextInput, TouchableOpacity, View, Platform } from 'react-native';
import { FontAwesomeIcon } from '@fortawesome/react-native-fontawesome';
import { faBell, faChevronLeft, faSearch } from '@fortawesome/free-solid-svg-icons';
import { generalFontSize, GlobalStyle, padding, textColor, gap, itemBg, whiteColor, themeColor, bgColor, blackColor, fontFamily, isIpad } from '../../Styles/Theme';
import { Path, Svg } from 'react-native-svg';
import { useNavigation } from '@react-navigation/native'; // Import useNavigation hook
import { useDrawerStatus } from '@react-navigation/drawer';
import { useSelector } from 'react-redux';


const NavHeader = ({ route, additionalProp, isCustomer }) => {
    const navigation = useNavigation(); // Access the navigation object
    const authData = useSelector((state) => state.auth.data)
    const token = useSelector((state) => state.auth.token)
    const searchInput = useRef()
    const [cartItems, setCartItems] = useState(cartData);
    const cartData = useSelector((state) => state.cart.data);
    // console.warn(route)
    const currentRouteName = route.name || 'Unknown';

    const toggleNavDrawer = () => {
        navigation.toggleDrawer(); // Open the drawer
    };

    useEffect(() => {
        setCartItems(cartData);
    }, [cartData])

    const goBack = () => {
        if (navigation.canGoBack()) {
            navigation.goBack();
        }
    };
    return (
        <>
            <View style={
                [
                    GlobalStyle.container,
                    GlobalStyle.row,
                    padding('left', 0),
                    GlobalStyle.aic,
                    padding("bottom", 5),
                    gap(10),
                    styles.headerStyle,
                ]
            }>
                {!isCustomer && (<TouchableOpacity style={styles.drawerBtn} onPress={toggleNavDrawer}>
                    <Svg width="23" height="15" viewBox="0 0 23 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <Path d="M0 7.33209C0.0230713 7.28821 0.0498352 7.24585 0.0686646 7.20026C0.261932 6.73187 0.617249 6.48865 1.11597 6.44507C1.17548 6.43982 1.23563 6.44257 1.2955 6.44257C8.09698 6.44244 14.8984 6.44318 21.7 6.44074C22.1475 6.44055 22.5289 6.56921 22.7871 6.9491C23.0379 7.31818 23.0672 7.71692 22.866 8.1178C22.6598 8.52863 22.3082 8.72632 21.8573 8.75836C21.7754 8.76428 21.6928 8.7605 21.6105 8.7605C14.9137 8.76056 8.21701 8.75482 1.52026 8.76868C0.803345 8.7702 0.26474 8.58099 0 7.87085V7.33209Z" fill={textColor} />
                        <Path d="M14.3705 2.85309C11.8798 2.85309 9.38914 2.85419 6.89854 2.85223C6.32072 2.85187 5.83409 2.43317 5.75474 1.88007C5.67082 1.29498 6.02299 0.750855 6.59617 0.596192C6.71666 0.56366 6.84715 0.557251 6.973 0.557129C11.902 0.555298 16.8309 0.556763 21.7598 0.553772C22.2735 0.553528 22.6637 0.754029 22.8821 1.22125C23.0832 1.65112 23.0245 2.0697 22.7237 2.43903C22.4878 2.72852 22.1738 2.85547 21.7975 2.85492C19.3218 2.85156 16.8462 2.85315 14.3705 2.85309Z" fill={textColor} />
                        <Path d="M16.6576 14.6473C14.9594 14.6473 13.2613 14.6494 11.5632 14.6462C10.9103 14.6449 10.469 14.2821 10.3575 13.6715C10.2399 13.0275 10.7597 12.3753 11.4144 12.3519C11.6535 12.3434 11.8932 12.3497 12.1325 12.3497C15.3642 12.3497 18.5959 12.3494 21.8275 12.35C22.3175 12.3501 22.677 12.5782 22.8822 13.0151C23.0841 13.445 23.0232 13.8637 22.7243 14.2336C22.4829 14.5325 22.1566 14.6511 21.7743 14.649C20.8542 14.6437 19.9341 14.6473 19.0139 14.6473C18.2285 14.6473 17.443 14.6473 16.6576 14.6473Z" fill={textColor} />
                    </Svg>
                </TouchableOpacity>)}
                {navigation.canGoBack() && currentRouteName !== 'home' && currentRouteName !== 'vendorHome' && currentRouteName !== 'thankyou' && (
                    <TouchableOpacity style={styles.drawerBtn} onPress={() => goBack()}>
                        <FontAwesomeIcon icon={faChevronLeft} size={generalFontSize} color={textColor} />
                    </TouchableOpacity>
                )}
                {/* {isCustomer && currentRouteName === 'home' && currentRouteName !== 'cart' && (
                    <TouchableOpacity
                        style={styles.drawerBtn}
                        onPress={() => navigation.navigate('cart')}
                    >
                        <Svg width="25" height="20" viewBox="0 0 20 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <Path d="M13.5294 12.9081C13.5294 13.283 13.3971 13.6027 13.1324 13.8673C12.8678 14.1319 12.5481 14.2643 12.1732 14.2643C11.7983 14.2643 11.4772 14.1319 11.2098 13.8673C10.9425 13.6027 10.8088 13.283 10.8088 12.9081C10.8088 12.5332 10.9425 12.2121 11.2098 11.9447C11.4772 11.6774 11.7983 11.5437 12.1732 11.5437C12.5481 11.5437 12.8678 11.6774 13.1324 11.9447C13.3971 12.2121 13.5294 12.5332 13.5294 12.9081ZM7.3357 12.9081C7.3357 13.283 7.20202 13.6027 6.93465 13.8673C6.66728 14.1319 6.34616 14.2643 5.97128 14.2643C5.59641 14.2643 5.27667 14.1319 5.01205 13.8673C4.74743 13.6027 4.61512 13.283 4.61512 12.9081C4.61512 12.5332 4.74743 12.2121 5.01205 11.9447C5.27667 11.6774 5.59641 11.5437 5.97128 11.5437C6.34616 11.5437 6.66728 11.6774 6.93465 11.9447C7.20202 12.2121 7.3357 12.5332 7.3357 12.9081ZM0.92703 0.553811C1.24126 0.884584 1.54584 1.17263 1.84078 1.41794C2.13573 1.66326 2.46925 1.88929 2.84137 2.09602C3.21348 2.30276 3.58835 2.47641 3.96598 2.61699C4.34361 2.75756 4.80118 2.88298 5.33868 2.99324C5.87617 3.1035 6.42746 3.19032 6.99253 3.25372C7.5576 3.31711 8.24671 3.3681 9.05984 3.40669C9.87298 3.44528 10.7109 3.47147 11.5737 3.48526C12.4365 3.49904 13.4632 3.50594 14.654 3.50594C15.4203 3.50594 16.0942 3.51972 16.6758 3.54728C17.2574 3.57485 17.7563 3.62033 18.1726 3.68373C18.5888 3.74713 18.9306 3.82293 19.1979 3.91113C19.4653 3.99933 19.661 4.10821 19.7851 4.23776C19.9091 4.36732 19.9753 4.50928 19.9835 4.66364C19.9918 4.818 19.938 4.9944 19.8223 5.19286C19.7065 5.39132 19.5508 5.60219 19.355 5.82546C19.1593 6.04873 18.9126 6.29956 18.6149 6.57796C18.3173 6.85636 17.9975 7.1444 17.6557 7.44209C17.3139 7.73979 16.9308 8.0678 16.5063 8.42613C15.4864 9.29165 14.6981 9.97248 14.1413 10.4686C14.3011 10.1875 14.512 9.88704 14.7739 9.56729C15.0357 9.24755 15.2948 8.95674 15.5512 8.69488C15.8075 8.43302 16.068 8.16151 16.3326 7.88035C16.5972 7.5992 16.826 7.34698 17.019 7.12371C17.2119 6.90044 17.3608 6.67855 17.4655 6.45804C17.5702 6.23752 17.6061 6.04458 17.573 5.87919C17.5399 5.7138 17.4145 5.56082 17.1967 5.42025C16.979 5.27968 16.6579 5.16666 16.2334 5.0812C15.8089 4.99575 15.2466 4.93097 14.5465 4.88687C13.8463 4.84277 13.0084 4.82899 12.0326 4.84553C11.1065 4.85655 10.2409 4.84001 9.43607 4.7959C8.63119 4.7518 7.92554 4.6884 7.31913 4.60571C6.71272 4.52302 6.14903 4.41001 5.62807 4.26666C5.10711 4.12332 4.66746 3.98136 4.30912 3.84079C3.95079 3.70022 3.61313 3.52794 3.29614 3.32397C2.97915 3.11999 2.72694 2.93669 2.5395 2.77406C2.35206 2.61143 2.16462 2.41435 1.97719 2.18281C1.78976 1.95127 1.65056 1.7597 1.5596 1.6081C1.46863 1.4565 1.35837 1.26906 1.22883 1.04579C1.09928 0.822521 0.998702 0.658554 0.92703 0.553811Z" fill={themeColor} />
                        </Svg>
                        {cartItems?.length !== 0 ? (
                            <View style={styles.cartItem}>
                                <Text style={styles.cartItemText}>{cartItems?.length ?? 0}</Text>
                            </View>
                        ) : null}
                    </TouchableOpacity>
                )} */}
                <View style={{ flex: 1 }}>
                    {/* {currentRouteName === 'home' ? (
                        <TouchableOpacity
                            activeOpacity={1}
                            onPress={() => {
                                // Focus the text input using the ref
                                if (searchInput.current) {
                                    searchInput.current.focus();
                                }
                            }}
                        >
                            <View style={[GlobalStyle.input, GlobalStyle.row, GlobalStyle.aic, { height: 40, paddingHorizontal: 0, paddingLeft: 20 }]}>
                                <FontAwesomeIcon icon={faSearch} color={'#828282'} size={generalFontSize - 4} />
                                <TextInput
                                    ref={searchInput}
                                    style={{ marginLeft: 10, height: 40, flex: 1 }} // Adjust spacing as needed
                                    placeholder="Search"
                                    placeholderTextColor="#828282"
                                />
                            </View>
                        </TouchableOpacity>
                    ) : (
                        <Text style={[!navigation.canGoBack() ? padding('left', 20) : '', styles.routeName]}>{authData?.name}</Text>
                    )} */}
                    <Text style={[!navigation.canGoBack() || currentRouteName == "home" ? padding('left', 20) : '', styles.routeName]}>Hello,  {authData?.name ?? "Happy Customer"}</Text>
                </View>
                {/* {isCustomer && currentRouteName !== 'home' && currentRouteName !== 'cart' && (
                    <TouchableOpacity
                        style={styles.drawerBtn}
                        onPress={() => navigation.navigate('cart')}
                    >
                        <Svg width="25" height="20" viewBox="0 0 20 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <Path d="M13.5294 12.9081C13.5294 13.283 13.3971 13.6027 13.1324 13.8673C12.8678 14.1319 12.5481 14.2643 12.1732 14.2643C11.7983 14.2643 11.4772 14.1319 11.2098 13.8673C10.9425 13.6027 10.8088 13.283 10.8088 12.9081C10.8088 12.5332 10.9425 12.2121 11.2098 11.9447C11.4772 11.6774 11.7983 11.5437 12.1732 11.5437C12.5481 11.5437 12.8678 11.6774 13.1324 11.9447C13.3971 12.2121 13.5294 12.5332 13.5294 12.9081ZM7.3357 12.9081C7.3357 13.283 7.20202 13.6027 6.93465 13.8673C6.66728 14.1319 6.34616 14.2643 5.97128 14.2643C5.59641 14.2643 5.27667 14.1319 5.01205 13.8673C4.74743 13.6027 4.61512 13.283 4.61512 12.9081C4.61512 12.5332 4.74743 12.2121 5.01205 11.9447C5.27667 11.6774 5.59641 11.5437 5.97128 11.5437C6.34616 11.5437 6.66728 11.6774 6.93465 11.9447C7.20202 12.2121 7.3357 12.5332 7.3357 12.9081ZM0.92703 0.553811C1.24126 0.884584 1.54584 1.17263 1.84078 1.41794C2.13573 1.66326 2.46925 1.88929 2.84137 2.09602C3.21348 2.30276 3.58835 2.47641 3.96598 2.61699C4.34361 2.75756 4.80118 2.88298 5.33868 2.99324C5.87617 3.1035 6.42746 3.19032 6.99253 3.25372C7.5576 3.31711 8.24671 3.3681 9.05984 3.40669C9.87298 3.44528 10.7109 3.47147 11.5737 3.48526C12.4365 3.49904 13.4632 3.50594 14.654 3.50594C15.4203 3.50594 16.0942 3.51972 16.6758 3.54728C17.2574 3.57485 17.7563 3.62033 18.1726 3.68373C18.5888 3.74713 18.9306 3.82293 19.1979 3.91113C19.4653 3.99933 19.661 4.10821 19.7851 4.23776C19.9091 4.36732 19.9753 4.50928 19.9835 4.66364C19.9918 4.818 19.938 4.9944 19.8223 5.19286C19.7065 5.39132 19.5508 5.60219 19.355 5.82546C19.1593 6.04873 18.9126 6.29956 18.6149 6.57796C18.3173 6.85636 17.9975 7.1444 17.6557 7.44209C17.3139 7.73979 16.9308 8.0678 16.5063 8.42613C15.4864 9.29165 14.6981 9.97248 14.1413 10.4686C14.3011 10.1875 14.512 9.88704 14.7739 9.56729C15.0357 9.24755 15.2948 8.95674 15.5512 8.69488C15.8075 8.43302 16.068 8.16151 16.3326 7.88035C16.5972 7.5992 16.826 7.34698 17.019 7.12371C17.2119 6.90044 17.3608 6.67855 17.4655 6.45804C17.5702 6.23752 17.6061 6.04458 17.573 5.87919C17.5399 5.7138 17.4145 5.56082 17.1967 5.42025C16.979 5.27968 16.6579 5.16666 16.2334 5.0812C15.8089 4.99575 15.2466 4.93097 14.5465 4.88687C13.8463 4.84277 13.0084 4.82899 12.0326 4.84553C11.1065 4.85655 10.2409 4.84001 9.43607 4.7959C8.63119 4.7518 7.92554 4.6884 7.31913 4.60571C6.71272 4.52302 6.14903 4.41001 5.62807 4.26666C5.10711 4.12332 4.66746 3.98136 4.30912 3.84079C3.95079 3.70022 3.61313 3.52794 3.29614 3.32397C2.97915 3.11999 2.72694 2.93669 2.5395 2.77406C2.35206 2.61143 2.16462 2.41435 1.97719 2.18281C1.78976 1.95127 1.65056 1.7597 1.5596 1.6081C1.46863 1.4565 1.35837 1.26906 1.22883 1.04579C1.09928 0.822521 0.998702 0.658554 0.92703 0.553811Z" fill={themeColor} />
                        </Svg>
                        {cartItems?.length !== 0 ? (
                            <View style={styles.cartItem}>
                                <Text style={styles.cartItemText}>{cartItems?.length ?? 0}</Text>
                            </View>
                        ) : null}
                    </TouchableOpacity>
                )} */}
                {isCustomer && (
                    <>
                        <TouchableOpacity onPress={() => {
                            navigation.navigate('products')
                        }}>
                            <Svg
                                width={isIpad ? '50' : '25'}
                                height={isIpad ? '40' : '20'}
                                viewBox="0 0 24 24"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg"
                            >
                                <Path
                                    d="M15.5 14H14.71L14.43 13.73C15.41 12.59 16 11.11 16 9.5C16 5.91 13.09 3 9.5 3C5.91 3 3 5.91 3 9.5C3 13.09 5.91 16 9.5 16C11.11 16 12.59 15.41 13.73 14.43L14 14.71V15.5L19 20.49L20.49 19L15.5 14ZM9.5 14C7.01 14 5 11.99 5 9.5C5 7.01 7.01 5 9.5 5C11.99 5 14 7.01 14 9.5C14 11.99 11.99 14 9.5 14Z"
                                    fill={themeColor}
                                />
                            </Svg>
                        </TouchableOpacity>

                        <TouchableOpacity
                            style={styles.drawerBtn}
                            onPress={() => navigation.navigate('cart')}
                        >
                            <Svg width={isIpad ? '50' : "25"} height={isIpad ? '40' : "20"} viewBox="0 0 20 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <Path d="M13.5294 12.9081C13.5294 13.283 13.3971 13.6027 13.1324 13.8673C12.8678 14.1319 12.5481 14.2643 12.1732 14.2643C11.7983 14.2643 11.4772 14.1319 11.2098 13.8673C10.9425 13.6027 10.8088 13.283 10.8088 12.9081C10.8088 12.5332 10.9425 12.2121 11.2098 11.9447C11.4772 11.6774 11.7983 11.5437 12.1732 11.5437C12.5481 11.5437 12.8678 11.6774 13.1324 11.9447C13.3971 12.2121 13.5294 12.5332 13.5294 12.9081ZM7.3357 12.9081C7.3357 13.283 7.20202 13.6027 6.93465 13.8673C6.66728 14.1319 6.34616 14.2643 5.97128 14.2643C5.59641 14.2643 5.27667 14.1319 5.01205 13.8673C4.74743 13.6027 4.61512 13.283 4.61512 12.9081C4.61512 12.5332 4.74743 12.2121 5.01205 11.9447C5.27667 11.6774 5.59641 11.5437 5.97128 11.5437C6.34616 11.5437 6.66728 11.6774 6.93465 11.9447C7.20202 12.2121 7.3357 12.5332 7.3357 12.9081ZM0.92703 0.553811C1.24126 0.884584 1.54584 1.17263 1.84078 1.41794C2.13573 1.66326 2.46925 1.88929 2.84137 2.09602C3.21348 2.30276 3.58835 2.47641 3.96598 2.61699C4.34361 2.75756 4.80118 2.88298 5.33868 2.99324C5.87617 3.1035 6.42746 3.19032 6.99253 3.25372C7.5576 3.31711 8.24671 3.3681 9.05984 3.40669C9.87298 3.44528 10.7109 3.47147 11.5737 3.48526C12.4365 3.49904 13.4632 3.50594 14.654 3.50594C15.4203 3.50594 16.0942 3.51972 16.6758 3.54728C17.2574 3.57485 17.7563 3.62033 18.1726 3.68373C18.5888 3.74713 18.9306 3.82293 19.1979 3.91113C19.4653 3.99933 19.661 4.10821 19.7851 4.23776C19.9091 4.36732 19.9753 4.50928 19.9835 4.66364C19.9918 4.818 19.938 4.9944 19.8223 5.19286C19.7065 5.39132 19.5508 5.60219 19.355 5.82546C19.1593 6.04873 18.9126 6.29956 18.6149 6.57796C18.3173 6.85636 17.9975 7.1444 17.6557 7.44209C17.3139 7.73979 16.9308 8.0678 16.5063 8.42613C15.4864 9.29165 14.6981 9.97248 14.1413 10.4686C14.3011 10.1875 14.512 9.88704 14.7739 9.56729C15.0357 9.24755 15.2948 8.95674 15.5512 8.69488C15.8075 8.43302 16.068 8.16151 16.3326 7.88035C16.5972 7.5992 16.826 7.34698 17.019 7.12371C17.2119 6.90044 17.3608 6.67855 17.4655 6.45804C17.5702 6.23752 17.6061 6.04458 17.573 5.87919C17.5399 5.7138 17.4145 5.56082 17.1967 5.42025C16.979 5.27968 16.6579 5.16666 16.2334 5.0812C15.8089 4.99575 15.2466 4.93097 14.5465 4.88687C13.8463 4.84277 13.0084 4.82899 12.0326 4.84553C11.1065 4.85655 10.2409 4.84001 9.43607 4.7959C8.63119 4.7518 7.92554 4.6884 7.31913 4.60571C6.71272 4.52302 6.14903 4.41001 5.62807 4.26666C5.10711 4.12332 4.66746 3.98136 4.30912 3.84079C3.95079 3.70022 3.61313 3.52794 3.29614 3.32397C2.97915 3.11999 2.72694 2.93669 2.5395 2.77406C2.35206 2.61143 2.16462 2.41435 1.97719 2.18281C1.78976 1.95127 1.65056 1.7597 1.5596 1.6081C1.46863 1.4565 1.35837 1.26906 1.22883 1.04579C1.09928 0.822521 0.998702 0.658554 0.92703 0.553811Z" fill={themeColor} />
                            </Svg>
                            {cartItems?.length > 0 ? (
                                <View style={styles.cartItem}>
                                    <Text style={styles.cartItemText}>{cartItems?.length}</Text>
                                </View>
                            ) : null}
                        </TouchableOpacity>
                        {token &&
                            <TouchableOpacity style={styles.drawerBtn} onPress={() => {
                                navigation.navigate('notifications')
                            }}>
                                <Svg
                                    width={isIpad ? '50' : '25'}
                                    height={isIpad ? '40' : '20'}
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    xmlns="http://www.w3.org/2000/svg"
                                >
                                    <Path
                                        d="M12 24C10.9 24 10 23.1 10 22H14C14 23.1 13.1 24 12 24ZM19 16V11C19 7.93 17.36 5.36 14.5 4.68V4C14.5 3.17 13.83 2.5 13 2.5H11C10.17 2.5 9.5 3.17 9.5 4V4.68C6.64 5.36 5 7.92 5 11V16L3 18V19H21V18L19 16ZM17 17H7V11C7 8.79 8.79 7 11 7H13C15.21 7 17 8.79 17 11V17Z"
                                        fill={themeColor}
                                    />
                                </Svg>
                            </TouchableOpacity>
                        }
                    </>
                )}
                {/* <TouchableOpacity
                    onPress={() => (navigation.navigate('notifications'))}
                    style={[styles.drawerBtn, styles.notiBtn]}
                >
                    <FontAwesomeIcon icon={faBell} color={whiteColor} size={generalFontSize} />
                </TouchableOpacity> */}
            </View>
        </>
    );
};

export default NavHeader;

const styles = StyleSheet.create({
    routeName: {
        fontFamily: 'FreightBigPro-Bold',
        fontSize: generalFontSize + 2,
        fontWeight: '900',
        color: textColor,
        textTransform: 'capitalize'
    },
    drawerBtn: {
        height: 30,
        width: 30,
        alignItems: "center",
        justifyContent: "center",
    },
    notiBtn: {
        backgroundColor: themeColor,
        borderRadius: 100
    },
    headerStyle: {
        backgroundColor: itemBg,
        height: 'auto',
        ...Platform.select({
            ios: {
                paddingTop: 60,
                minHeight: 110,
            },
            android: {
                paddingTop: 10,
                minHeight: 50,
            }
        })
    },
    cartItemText: {
        color: whiteColor,
        fontSize: generalFontSize - 4,
        ...fontFamily("medium"),
        fontWeight: '700',
    },
    cartItem: {
        backgroundColor: themeColor,
        alignItems: 'center',
        justifyContent: 'center',
        width: isIpad ? 30 : 15,
        height: isIpad ? 30 : 15,
        position: 'absolute',
        top: isIpad ? -20 : -5,
        right: isIpad ? -20 : -5,
        borderRadius: 100,
        zIndex: 11
    }
});
